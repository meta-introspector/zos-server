[workspace]
members = [
    "zos-macros",
    "zos-traits",
    "zos-types",
    "zos-build-macros"
]
resolver = "2"

[workspace.dependencies]
# Zero deps foundation
zos-macros = { path = "zos-macros" }
zos-traits = { path = "zos-traits" }
zos-types = { path = "zos-types" }
zos-build-macros = { path = "zos-build-macros" }

[package]
name = "zos-server"
version = "0.1.0"
edition = "2021"
description = "Zero Ontology System - Complete plugin-based computation platform"
license = "AGPL-3.0"
repository = "https://github.com/meta-introspector/zos-server"

[[bin]]
name = "zos_server"
path = "src/main.rs"

[dependencies]
# Foundation (zero deps)
zos-macros = { workspace = true }
zos-traits = { workspace = true }
zos-types = { workspace = true }

# Optional runtime deps
serde = { version = "1.0", features = ["derive"], optional = true }
serde_json = { version = "1.0", optional = true }
uuid = { version = "1.0", features = ["v4"], optional = true }
tokio = { version = "1.0", features = ["rt", "macros"], optional = true }

[build-dependencies]
zos-build-macros = { workspace = true }

[features]
default = []
slim = []

# Layer -4: Advanced ZK
advanced_zk = ["rollups", "lattice_folding", "hme", "metacoq", "lean4"]
rollups = []
lattice_folding = []
hme = []
metacoq = []
lean4 = []

# Layer -3: Zero Knowledge
zk = ["zk_snarks", "zk_starks", "correctness_proofs"]
zk_snarks = []
zk_starks = []
correctness_proofs = []

# Layer -2: Regulatory
regulatory = ["sec_compliance", "quality_assurance", "gdpr", "hipaa", "sox", "iso"]
sec_compliance = []
quality_assurance = []
gdpr = []
hipaa = []
sox = []
iso = []

# Layer -1: Governance
governance = ["voting_systems", "resource_management", "erp_integration"]
voting_systems = []
resource_management = []
erp_integration = []

# Layer 0: Foundation
foundation = ["lmfdb", "wikidata", "openstreetmap", "archive_org", "sdf_org"]
lmfdb = []
wikidata = []
openstreetmap = []
archive_org = []
sdf_org = []

# Layer 1: System (19 plugins)
system = ["systemd", "docker", "compilers", "blockchain", "kernel", "ebpf", "wasm", "runtime_plugins", "storage", "networking", "security", "telemetry", "debug", "bintools", "libp2p", "solana", "oracle", "enterprise", "modeling"]
systemd = []
docker = []
compilers = []
blockchain = []
kernel = []
ebpf = []
wasm = []
runtime_plugins = []
storage = []
networking = []
security = []
telemetry = []
debug = []
bintools = []
libp2p = []
solana = []
oracle = []
enterprise = []
modeling = []

# Layer 2: Data Formats
data_formats = ["parquet", "huggingface", "rdf", "sql", "protocols", "dataflow", "knowledge"]
parquet = []
huggingface = []
rdf = []
sql = []
protocols = []
dataflow = []
knowledge = []

# Layer âˆž: Recursive
recursive = ["infinite_export", "cross_layer_communication", "recursive_verification"]
infinite_export = []
cross_layer_communication = []
recursive_verification = []

# Runtime dependencies (optional)
serde = ["dep:serde", "dep:serde_json"]
runtime = ["dep:uuid", "dep:tokio"]
full = ["serde", "runtime"]

# Complete layer sets
all_layers = ["advanced_zk", "zk", "regulatory", "governance", "foundation", "system", "data_formats", "recursive"]

[profile.release]
opt-level = 3
lto = true
codegen-units = 1
panic = "abort"
